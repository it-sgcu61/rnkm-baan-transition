# Build image for every service before deploy, including backend.
version: '3'
volumes:
  node_modules:
  node_modules-for-sentinel:
services:
  rnkm-baan-transition:
    image: "gcr.io/skylab-184008/rnkm-baan-transition:1.0"
    volumes:
     - ./:/backend
     - node_modules:/backend/node_modules
    working_dir: /backend
    command: node app.js
    ports:
     - "8080:3000"
    networks:
     - datanaliez-cluster
    environment:
      - dtnlAddr=datanaliez:3011
      - redisAddr=redis-redis-ha-master-svc
      - formID_TH=a2d512a69efebe44cf6749ff37e235be01d066e9a1fa2b7caba34b5d2b309fab
      - formID_EN=2f1a1b950af77e04c2294ba116af1b9bfefe53aa73eed282d32dc2d643f7b333
      - startTime=Thu Aug 03 2018 15:00:00 GMT+0700 (Indochina Time)
      - endTime=Thu Aug 03 2018 23:50:00 GMT+0700 (Indochina Time)
  rnkm-baan-transition-sentinel:
    image: "gcr.io/skylab-184008/rnkm-baan-transition-sentinel:1.0"
    volumes:
     - ./sentinel:/backend
     - node_modules-for-sentinel:/backend/node_modules
    working_dir: /backend
    command: node app.js
    environment:
      - endTime=Thu Aug 03 2018 23:50:00 GMT+0700 (Indochina Time)
      - dtnlAddr=datanaliez:3011
      - redisAddr=redis-redis-ha-master-svc
    links:
     - rnkm-baan-transition
    networks:
     - datanaliez-cluster
networks:
  datanaliez-cluster:
    external:
      name: datanaliez_default
